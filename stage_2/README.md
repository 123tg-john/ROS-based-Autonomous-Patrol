# 第二階段：巡邏偵測模型 (Stage 2: Patrol & Detection Model)

這個資料夾存放了第二階段「巡邏與異常偵測」模型的訓練成果。此階段的訓練建立在第一階段的通用導航模型之上，透過遷移學習的方式，讓 Agent 進一步學習在特定區域內自主巡邏，並同時偵測環境中的異常狀況。

本專案實現並比較了兩種不同的異常偵測訓練方法，分別存放在對應的資料夾中。

## 核心訓練方法論

### 方法一：基於代價地圖 (Costmap-based Method)

[cite_start]這種方法的核心是利用 ROS Navigation Stack 提供的**代價地圖 (Costmap)** 作為環境的先驗知識，來教導 Agent 區分已知的牆壁與新增的異常障礙物 [cite: 48, 297]。

* **判斷原理**：
    1.  [cite_start]在 Agent 運行的每一步，系統會將即時的雷射掃描點（LIDAR scan）投影到代價地圖的座標上 [cite: 369]。
    2.  [cite_start]接著，系統會檢查這些座標點在代價地圖上的 `cost` 值 [cite: 369]。
    3.  [cite_start]如果雷射點打在一個 `cost` 值很高的區域，系統會判定這是地圖上已知的牆壁，**不啟用**獎懲機制 [cite: 369, 370]。
    4.  [cite_start]如果雷射點打在一個理論上應為可通行區域（`cost` 值很低）的地方，系統則判定偵測到了未知的「異常障礙物」，並**啟用**對應的獎懲機制來訓練 Agent 的偵測能力 [cite: 369, 370]。

* **訓練目的**：此方法的目的是讓 SAC Agent 學會利用環境的先驗知識，精準地識別出與地圖不符的靜態異常。

### 方法二：基於基線掃描差異 (Baseline Scan Difference Method)

[cite_start]這種方法不依賴任何預先建立的地圖，而是專注於環境的**動態變化** [cite: 48, 299]。

* **判斷原理**：
    1.  [cite_start]在每個訓練回合開始時，Agent 會先在一個沒有異常的環境中，於巡邏區域的中心點進行一次「**基準掃描 (Baseline Scan)**」，並將其記錄下來 [cite: 299]。
    2.  [cite_start]在隨後的巡邏過程中，Agent 會持續將**當前的雷射掃描**與先前儲存的「基準掃描」進行比對，計算兩者之間的差異量 [cite: 299, 331]。
    3.  [cite_start]在沒有異常的情況下，兩次掃描的差異量會非常小 [cite: 318]。
    4.  [cite_start]當環境中出現新的障礙物時，會導致當前的雷射掃描距離突然縮短，使得與基準掃描的差異量**瞬間大幅變大** [cite: 318]。

* **訓練目的**：讓 SAC Agent 學會將這種「掃描數據的大幅度突然變化」視為存在異常的信號，從而學習到一種不依賴地圖的動態異常偵測能力。

## 資料夾結構

本資料夾根據上述兩種訓練方法以及所使用的地圖類型，分為以下子資料夾。每個資料夾內都只存放最新訓練完成的模型檔案。

- **`costmap_method/`**
    - `occupancy_grid_map/`: 存放使用「代價地圖法」在「點陣式地圖」上訓練的模型。
- **`scan_difference_method/`**
    - `occupancy_grid_map/`: 存放使用「基線比對法」在「點陣式地圖」上訓練的模型。
    - `rectangular_map/`: 存放使用「基線比對法」在「矩形地圖」上訓練的模型。

## 如何使用

此處的模型主要用於 `patrol_manager.py` 部署腳本中。當第一階段的導航模型將機器人引導至巡邏區域中心後，系統會切換並載入第二階段的模型，開始執行精細的區域內巡邏與即時異常偵測任務。
